<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Project</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      padding: 20px;
      line-height: 1.6;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    
    .header {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 16px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
      backdrop-filter: blur(10px);
      padding: 25px;
      margin-bottom: 30px;
      text-align: center;
    }
    
    .header h1 { 
      color: #2c3e50;
      font-size: 2.2em;
      font-weight: 300;
      margin-bottom: 15px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      letter-spacing: 1px;
    }
    
    .project-info {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    
    .info-badge {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9em;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .info-badge.secondary {
      background: linear-gradient(135deg, #28a745, #20c997);
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    }
    
    .edit-form {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 35px;
      margin-bottom: 30px;
    }
    
    .form-section {
      margin-bottom: 30px;
    }
    
    .section-title {
      font-weight: 600;
      margin-bottom: 15px;
      color: #2c3e50;
      font-size: 1.2em;
      padding-bottom: 8px;
      border-bottom: 2px solid #e9ecef;
      position: relative;
    }
    
         .section-title::after {
       content: '';
       position: absolute;
       bottom: -2px;
       left: 0;
       width: 60px;
       height: 2px;
       background: linear-gradient(90deg, #667eea, #764ba2);
     }
     
     .form-row {
       display: grid;
       grid-template-columns: 1fr 1fr;
       gap: 20px;
       margin-top: 15px;
     }
     
     .form-group {
       display: flex;
       flex-direction: column;
     }
     
     .form-group label {
       font-weight: 600;
       color: #495057;
       margin-bottom: 8px;
       font-size: 0.95em;
     }
     
     .form-group input[type="text"] {
       padding: 12px 16px;
       border: 2px solid #e9ecef;
       border-radius: 10px;
       font-size: 1em;
       transition: all 0.3s ease;
       background: white;
     }
     
     .form-group input[type="text"]:focus {
       outline: none;
       border-color: #667eea;
       box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
     }
     
     .skills-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }
    
    .skill-checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px;
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .skill-checkbox:hover {
      border-color: #667eea;
      background: #f0f2ff;
    }
    
    .skill-checkbox input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #667eea;
    }
    
    .skill-checkbox label {
      cursor: pointer;
      font-weight: 500;
      color: #495057;
      flex: 1;
    }
    
    .custom-input-section {
      margin-top: 20px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 12px;
      border: 2px solid #e9ecef;
    }
    
    .custom-input-section h4 {
      color: #2c3e50;
      margin-bottom: 15px;
      font-size: 1em;
    }
    
    .custom-input-row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .custom-input-row input[type="text"] {
      flex: 1;
      padding: 10px 14px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 0.9em;
      transition: all 0.3s ease;
    }
    
    .custom-input-row input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .add-btn {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
    }
    
    .add-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
    }
    
    .remove-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .remove-btn:hover {
      background: #c82333;
      transform: translateY(-1px);
    }
    
        .form-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
    }

    .save-btn {
      padding: 15px 30px;
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1.1em;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
      min-width: 140px;
    }
    
    .save-btn:hover { 
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
    }

    .cancel-btn {
      padding: 15px 30px;
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1.1em;
      font-weight: 600;
      transition: all 0.3s ease;
      min-width: 140px;
    }
    
    .cancel-btn:hover {
      background: #5a6268;
      transform: translateY(-2px);
    }
    
    .nav-bar {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 30px;
      display: flex;
      justify-content: flex-end;
      gap: 20px;
      flex-wrap: wrap;
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
      backdrop-filter: blur(10px);
    }

    .nav-link {
      color: #2c3e50;
      text-decoration: none;
      font-weight: 600;
      padding: 8px 16px;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-size: 0.95em;
    }

    .nav-link:hover {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      transform: translateY(-1px);
    }

    .nav-link.active {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }

    
    .loading {
      text-align: center;
      padding: 40px;
      color: #6c757d;
    }
    
    .error {
      background: #f8d7da;
      color: #721c24;
      padding: 15px;
      border-radius: 12px;
      margin: 20px 0;
      border: 1px solid #f5c6cb;
      text-align: center;
    }
    
         @media (max-width: 768px) {
       body { padding: 15px; }
       
       .header h1 { font-size: 1.8em; }
       
       .edit-form { padding: 25px; }
       
       .nav-bar {
         flex-direction: column;
         gap: 10px;
         padding: 20px;
       }
       
       .nav-link {
         width: 100%;
         text-align: center;
         padding: 12px 16px;
       }
       
       .project-info {
         flex-direction: column;
         align-items: center;
         gap: 10px;
       }
       
       .form-row {
         grid-template-columns: 1fr;
         gap: 15px;
       }
       
       .skills-grid {
         grid-template-columns: 1fr;
       }
       
       .form-actions {
         flex-direction: column;
         align-items: center;
       }

       .save-btn,
       .cancel-btn {
         width: 100%;
         max-width: 200px;
       }
     }
  </style>
</head>
<body>
  <div class="container">
    <div class="nav-bar">
      <a href="/admin/dashboard" class="nav-link">Home</a>
      <a href="/admin" class="nav-link">Projects</a>
      <a href="/admin/allocation" class="nav-link">View allocation</a>
      <a href="/logout" class="nav-link" style="color:#e74c3c;">Logout</a>
    </div>
    
    <div class="header">
      <h1>✏️ Edit Project</h1>
      <div class="project-info">
        <span class="info-badge" id="projectId">Loading...</span>
        <span class="info-badge secondary" id="projectTitle">Loading...</span>
        <span class="info-badge secondary" id="projectClient">Loading...</span>
      </div>
    </div>

         <div class="edit-form">
       <div class="form-section">
         <h3 class="section-title">Project Information</h3>
         <div class="form-row">
           <div class="form-group">
             <label for="projectTitleInput">Project Title</label>
             <input type="text" id="projectTitleInput" placeholder="Enter project title">
           </div>
           <div class="form-group">
             <label for="projectClientInput">Client</label>
             <input type="text" id="projectClientInput" placeholder="Enter client name">
           </div>
         </div>
       </div>

       <div class="form-section">
         <h3 class="section-title">Required Skills</h3>
         <div class="skills-grid" id="skillsGrid">
           <!-- Skills checkboxes will be rendered here -->
         </div>
         
         <div class="custom-input-section">
           <h4>Add Custom Skill</h4>
           <div class="custom-input-row">
             <input type="text" id="customSkillInput" placeholder="Enter custom skill name">
             <button class="add-btn" onclick="addCustomSkill()">Add</button>
           </div>
         </div>
       </div>

      <div class="form-section">
        <h3 class="section-title">Related Disciplines</h3>
        <div class="skills-grid" id="disciplinesGrid">
          <!-- Disciplines checkboxes will be rendered here -->
        </div>
        
        <div class="custom-input-section">
          <h4>Add Custom Discipline</h4>
          <div class="custom-input-row">
            <input type="text" id="customDisciplineInput" placeholder="Enter custom discipline name">
            <button class="add-btn" onclick="addCustomDiscipline()">Add</button>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button class="cancel-btn" onclick="cancelEdit()">Cancel</button>
        <button class="save-btn" onclick="saveChanges()">Save Changes</button>
      </div>
    </div>
  </div>

  <script>
    const availableSkills = [
      "Python", "Java", "C++", "SQL", "HTML", "CSS", "JavaScript",
      "Machine Learning", "Data Analysis", "Communication", "Teamwork"
    ];

    const availableDisciplines = [
      "Software Development", "Web Development", "AI", "Machine Learning", "Data Science",
      "Computer Vision", "NLP", "Cybersecurity", "Database Systems", "Cloud Computing"
    ];

    let currentProject = null;
    let projectId = null;

    async function loadProject() {
      try {
        // Get project ID from localStorage
        projectId = localStorage.getItem("editProjectId");
        if (!projectId) {
          showError("No project ID found. Please go back and select a project to edit.");
          return;
        }

                 // Load the specific project using admin endpoint
         const response = await fetch(`/admin/projects/${projectId}`);
         if (!response.ok) {
           throw new Error("Project not found");
         }
         
         currentProject = await response.json();
         if (!currentProject) {
           showError("Project not found. Please go back and try again.");
           return;
         }

                 // Update header information
         document.getElementById("projectId").textContent = currentProject.id;
         document.getElementById("projectTitle").textContent = currentProject.title || 'Untitled';
         document.getElementById("projectClient").textContent = currentProject.client || 'N/A';

         // Fill form inputs
         document.getElementById("projectTitleInput").value = currentProject.title || '';
         document.getElementById("projectClientInput").value = currentProject.client || '';

         // Render skills grid
         renderSkillsGrid();
         
         // Render disciplines grid
         renderDisciplinesGrid();

      } catch (error) {
        console.error("Error loading project:", error);
        showError("Failed to load project: " + error.message);
      }
    }

    function renderSkillsGrid() {
      const grid = document.getElementById("skillsGrid");
      grid.innerHTML = "";

      // Create checkboxes for available skills
      availableSkills.forEach(skill => {
        const checkbox = document.createElement("div");
        checkbox.className = "skill-checkbox";
        
        const input = document.createElement("input");
        input.type = "checkbox";
        input.id = `skill-${skill}`;
        input.checked = currentProject.required_skills && currentProject.required_skills.includes(skill);
        
        const label = document.createElement("label");
        label.setAttribute("for", `skill-${skill}`);
        label.textContent = skill;
        
        checkbox.appendChild(input);
        checkbox.appendChild(label);
        grid.appendChild(checkbox);
      });

      // Add custom skills that are not in the predefined list
      if (currentProject.required_skills) {
        currentProject.required_skills.forEach(skill => {
          if (!availableSkills.includes(skill)) {
            addCustomSkillToGrid(skill, true);
          }
        });
      }
    }

    function renderDisciplinesGrid() {
      const grid = document.getElementById("disciplinesGrid");
      grid.innerHTML = "";

      // Create checkboxes for available disciplines
      availableDisciplines.forEach(discipline => {
        const checkbox = document.createElement("div");
        checkbox.className = "skill-checkbox";
        
        const input = document.createElement("input");
        input.type = "checkbox";
        input.id = `discipline-${discipline}`;
        input.checked = currentProject.related_disciplines && currentProject.related_disciplines.includes(discipline);
        
        const label = document.createElement("label");
        label.setAttribute("for", `discipline-${discipline}`);
        label.textContent = discipline;
        
        checkbox.appendChild(input);
        checkbox.appendChild(label);
        grid.appendChild(checkbox);
      });

      // Add custom disciplines that are not in the predefined list
      if (currentProject.related_disciplines) {
        currentProject.related_disciplines.forEach(discipline => {
          if (!availableDisciplines.includes(discipline)) {
            addCustomDisciplineToGrid(discipline, true);
          }
        });
      }
    }

    function addCustomSkill() {
      const input = document.getElementById("customSkillInput");
      const skillName = input.value.trim();
      
      if (!skillName) {
        alert("Please enter a skill name");
        return;
      }
      
      if (availableSkills.includes(skillName)) {
        alert("This skill is already in the predefined list");
        return;
      }
      
      addCustomSkillToGrid(skillName, false);
      input.value = "";
    }

    function addCustomSkillToGrid(skillName, isChecked = false) {
      const grid = document.getElementById("skillsGrid");
      const checkbox = document.createElement("div");
      checkbox.className = "skill-checkbox";
      
      const input = document.createElement("input");
      input.type = "checkbox";
      input.id = `skill-${skillName}`;
      input.checked = isChecked;
      
      const label = document.createElement("label");
      label.setAttribute("for", `skill-${skillName}`);
      label.textContent = skillName;
      
      const removeBtn = document.createElement("button");
      removeBtn.className = "remove-btn";
      removeBtn.textContent = "×";
      removeBtn.onclick = () => checkbox.remove();
      
      checkbox.appendChild(input);
      checkbox.appendChild(label);
      checkbox.appendChild(removeBtn);
      grid.appendChild(checkbox);
    }

    function addCustomDiscipline() {
      const input = document.getElementById("customDisciplineInput");
      const disciplineName = input.value.trim();
      
      if (!disciplineName) {
        alert("Please enter a discipline name");
        return;
      }
      
      if (availableDisciplines.includes(disciplineName)) {
        alert("This discipline is already in the predefined list");
        return;
      }
      
      addCustomDisciplineToGrid(disciplineName, false);
      input.value = "";
    }

    function addCustomDisciplineToGrid(disciplineName, isChecked = false) {
      const grid = document.getElementById("disciplinesGrid");
      const checkbox = document.createElement("div");
      checkbox.className = "skill-checkbox";
      
      const input = document.createElement("input");
      input.type = "checkbox";
      input.id = `discipline-${disciplineName}`;
      input.checked = isChecked;
      
      const label = document.createElement("label");
      label.setAttribute("for", `discipline-${disciplineName}`);
      label.textContent = disciplineName;
      
      const removeBtn = document.createElement("button");
      removeBtn.className = "remove-btn";
      removeBtn.textContent = "×";
      removeBtn.onclick = () => checkbox.remove();
      
      checkbox.appendChild(input);
      checkbox.appendChild(label);
      checkbox.appendChild(removeBtn);
      grid.appendChild(checkbox);
    }

         async function saveChanges() {
       try {
         // Collect project title and client
         const projectTitle = document.getElementById("projectTitleInput").value.trim();
         const projectClient = document.getElementById("projectClientInput").value.trim();
         
         if (!projectTitle) {
           alert("Please enter a project title");
           return;
         }
         
         if (!projectClient) {
           alert("Please enter a client name");
           return;
         }

         // Collect selected skills
         const selectedSkills = [];
         document.querySelectorAll('#skillsGrid input[type="checkbox"]:checked').forEach(checkbox => {
           const skillName = checkbox.id.replace('skill-', '');
           selectedSkills.push(skillName);
         });

         // Collect selected disciplines
         const selectedDisciplines = [];
         document.querySelectorAll('#disciplinesGrid input[type="checkbox"]:checked').forEach(checkbox => {
           const disciplineName = checkbox.id.replace('discipline-', '');
           selectedDisciplines.push(disciplineName);
         });

         // Update current project
         currentProject.title = projectTitle;
         currentProject.client = projectClient;
         currentProject.required_skills = selectedSkills;
         currentProject.related_disciplines = selectedDisciplines;

                 // Update the project using admin endpoint
         const saveResponse = await fetch(`/admin/projects/${projectId}`, {
           method: "PUT",
           headers: { "Content-Type": "application/json" },
           body: JSON.stringify(currentProject)
         });
         
         if (saveResponse.ok) {
           alert("Project updated successfully!");
           window.location.href = "/admin";
         } else {
           throw new Error("Failed to save project");
         }

      } catch (error) {
        console.error("Error saving project:", error);
        alert("Failed to save project: " + error.message);
      }
    }

    function cancelEdit() {
      if (confirm("Are you sure you want to cancel? All changes will be lost.")) {
        window.location.href = "/admin";
      }
    }


    function showError(message) {
      const container = document.querySelector('.edit-form');
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error';
      errorDiv.textContent = message;
      container.parentNode.insertBefore(errorDiv, container);
    }

    // Load project when page loads
    document.addEventListener('DOMContentLoaded', loadProject);
  </script>
</body>
</html>
